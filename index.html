<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AxieBreed</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1e88e5"/>
  <style>
    body{font-family:Inter,Arial,Helvetica,sans-serif;margin:0;padding:18px;background:#f6f9fc;color:#111}
    .card{background:#fff;border-radius:10px;padding:14px;margin-bottom:12px;box-shadow:0 6px 18px rgba(20,30,50,0.06)}
    h1{margin:0 0 8px 0;font-size:20px}
    label{display:block;margin:8px 0 6px;font-weight:600}
    input[type=text], input[type=number], select, textarea{width:100%;padding:8px;border:1px solid #e1e6ee;border-radius:8px}
    button{background:#1e88e5;color:#fff;padding:10px 12px;border-radius:10px;border:0;font-weight:700;cursor:pointer}
    pre{white-space:pre-wrap;word-break:break-word;background:#f4f7fb;padding:10px;border-radius:8px}
    .row{display:flex;gap:8px}
    .col{flex:1}
  </style>
</head>
<body>
  <div class="card">
    <h1>AxieBreed</h1>
    <div style="font-size:13px;color:#555">App para simular probabilidades de breeding. Backend: <strong id="apiUrl"></strong></div>
  </div>

  <div class="card">
    <label>Importar CSV de Axies (plantilla disponible)</label>
    <input type="file" id="csvfile" accept=".csv"/>
    <div style="margin-top:8px"><button onclick="uploadCsv()">Subir CSV</button></div>
    <div id="importResult" style="margin-top:8px"></div>
  </div>

  <div class="card">
    <label>Listar Axies guardados</label>
    <div style="margin-bottom:8px"><button onclick="listAxies()">Refrescar lista</button></div>
    <div id="axieList"></div>
  </div>

  <div class="card">
    <label>Simular cruce</label>
    <div class="row">
      <div class="col">
        <label>Padre A (ID)</label>
        <input type="text" id="parentA" placeholder="1" value="1"/>
      </div>
      <div class="col">
        <label>Padre B (ID)</label>
        <input type="text" id="parentB" placeholder="2" value="2"/>
      </div>
      <div style="width:120px">
        <label>Simulaciones</label>
        <input type="number" id="n" value="2000" min="100" step="100"/>
      </div>
    </div>
    <div style="margin-top:10px"><button onclick="simulate()">Simular</button></div>
    <div id="simResult" style="margin-top:10px"></div>
  </div>

  <div style="text-align:center;margin-top:12px;color:#777;font-size:13px">
    Si la app no detecta el backend, revisa que la URL esté disponible y que tu backend está en línea.
  </div>

<script>
  // URL del backend ya desplegado (tuya)
  const BACKEND = "https://axiebreed-od2v.onrender.com";
  document.getElementById('apiUrl').innerText = BACKEND;

  async function uploadCsv(){
    const f = document.getElementById('csvfile').files[0];
    if(!f){ alert('Selecciona un CSV'); return; }
    const form = new FormData();
    form.append('file', f);
    const res = await fetch(BACKEND + '/import_csv', {method:'POST', body: form});
    const j = await res.json();
    document.getElementById('importResult').innerText = JSON.stringify(j);
  }

  async function listAxies(){
    try{
      const res = await fetch(BACKEND + '/axies');
      const arr = await res.json();
      if(!Array.isArray(arr)){ document.getElementById('axieList').innerText = JSON.stringify(arr); return; }
      let html = '<table style="width:100%;border-collapse:collapse"><tr><th style="text-align:left">ID</th><th style="text-align:left">Name</th><th>Parts</th></tr>';
      for(const a of arr){
        html += `<tr><td style="padding:6px;border-top:1px solid #eee">${a.id}</td><td style="padding:6px;border-top:1px solid #eee">${a.name}</td><td style="padding:6px;border-top:1px solid #eee"><pre>${JSON.stringify(a.parts,null,2)}</pre></td></tr>`;
      }
      html += '</table>';
      document.getElementById('axieList').innerHTML = html;
    }catch(e){
      document.getElementById('axieList').innerText = 'Error: no se puede conectar al backend. ' + e;
    }
  }

  async function simulate(){
    const a = document.getElementById('parentA').value;
    const b = document.getElementById('parentB').value;
    const n = document.getElementById('n').value || 2000;
    const body = new URLSearchParams();
    body.append('parentA_id', a);
    body.append('parentB_id', b);
    body.append('n', n);
    const res = await fetch(BACKEND + '/breed/simulate', {method:'POST', body: body});
    const j = await res.json();
    document.getElementById('simResult').innerHTML = '<pre>' + JSON.stringify(j, null, 2) + '</pre>';
  }

  // Auto list on load
  (async ()=>{ try{ await listAxies(); }catch(e){} })();
</script>
</body>
</html>
